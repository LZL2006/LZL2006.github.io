<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ææŒ¯äº®çš„æ˜Ÿç©º | Li Zhenliang's Space</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --accent: #00cec9;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text: #ffffff;
            --bg-deep: #0f0c29;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: var(--bg-deep);
            color: var(--text);
            overflow: hidden; /* é˜²æ­¢bodyæ»šåŠ¨ï¼Œç”±appå®¹å™¨ç®¡ç†æ»šåŠ¨ */
            height: 100vh;
            width: 100vw;
        }

        /* å±‚çº§ä¿®æ­£ï¼šèƒŒæ™¯ < å†…å®¹ < ç‰¹æ•ˆ */
        #star-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        #visualizer { position: fixed; bottom: 0; left: 0; width: 100%; height: 120px; z-index: 1; pointer-events: none; opacity: 0.5; }
        #effect-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 99999; pointer-events: none; } /* æœ€é«˜å±‚çº§ï¼Œä¸æŒ¡æ“ä½œ */

        /* App ä¸»å®¹å™¨ */
        #app {
            position: relative;
            z-index: 10;
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* å†…å®¹åœ¨æ­¤å¤„æ»šåŠ¨ */
            scroll-behavior: smooth;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(15, 12, 41, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--glass-border);
        }

        .user-panel { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; }
        .login-btn { background: var(--primary); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }

        /* æœç´¢æ¡† */
        .search-box {
            position: relative;
            max-width: 400px;
            width: 100%;
            margin: 20px auto;
            padding: 0 20px;
        }
        .search-input {
            width: 100%;
            padding: 12px 40px 12px 20px;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            background: rgba(0,0,0,0.3);
            color: #fff;
            outline: none;
            transition: 0.3s;
        }
        .search-input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 206, 201, 0.3); }
        .search-icon { position: absolute; right: 35px; top: 50%; transform: translateY(-50%); color: #aaa; cursor: pointer;}

        /* å†…å®¹å¡ç‰‡ */
        .card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            margin: 0 20px 20px;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .card:hover { transform: translateY(-2px); }

        /* ä¸ªäººèµ„æ–™åŒº */
        .profile-card { text-align: center; margin-top: 20px; }
        .main-avatar { 
            width: 130px; height: 130px; border-radius: 50%; 
            border: 4px solid var(--primary); margin-bottom: 15px; 
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.4);
            object-fit: cover;
        }
        .map-link { color: #00cec9; text-decoration: none; margin: 10px 0; display: inline-block; font-size: 0.9rem; }
        
        .social-bar { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .social-icon { 
            width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.1); 
            display: flex; align-items: center; justify-content: center; font-size: 1.4rem; 
            cursor: pointer; transition: 0.3s; position: relative;
        }
        .social-icon:hover { transform: scale(1.1); background: var(--primary); }

        /* åšå®¢æ–‡ç« æ ·å¼ */
        .post-meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: #aaa; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;}
        .post-actions span { margin-left: 15px; cursor: pointer; transition: 0.2s; }
        .post-actions span:hover { color: var(--accent); }
        .liked { color: #ff6b6b !important; }

        /* è¯„è®ºåŒº */
        .comment-section { margin-top: 15px; display: none; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;}
        .comment-section.active { display: block; }
        .comment-input { width: 100%; background: transparent; border: none; border-bottom: 1px solid #555; color: #fff; padding: 5px; outline: none; }
        .comment-list { margin-top: 10px; font-size: 0.85rem; }
        .comment-item { margin-bottom: 8px; border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 5px; }

        /* ç™»å½•å¼¹çª— */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;
        }
        .modal-box {
            background: #2d3436; padding: 30px; border-radius: 15px; width: 90%; max-width: 350px; text-align: center;
            border: 1px solid var(--accent); box-shadow: 0 0 30px rgba(0, 206, 201, 0.2);
        }
        .auth-btn { width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px;}
        .btn-qq { background: #12B7F5; }
        .btn-wx { background: #07C160; }
        .btn-guest { background: #636e72; }
        
        /* èµ„æºç½‘æ ¼ */
        .grid-box { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .res-btn {
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center;
            text-decoration: none; color: #ddd; transition: 0.3s; display: block; font-size: 0.9rem;
        }
        .res-btn:hover { background: var(--primary); color: #fff; }
        .res-btn i { display: block; font-size: 1.5rem; margin-bottom: 8px; color: var(--accent); }

        /* æ ‡ç­¾é¡µå¯¼èˆª */
        .nav-tabs { display: flex; justify-content: center; margin-bottom: 20px; gap: 15px; }
        .tab { padding: 8px 20px; border-radius: 20px; cursor: pointer; opacity: 0.6; transition: 0.3s; }
        .tab.active { background: var(--primary); opacity: 1; font-weight: bold; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Admin Link (Hidden for guests) */
        .admin-link { position: fixed; bottom: 20px; right: 20px; font-size: 0.8rem; color: #555; text-decoration: none; z-index: 200; }
    </style>
</head>
<body>

    <canvas id="star-canvas"></canvas>
    <canvas id="visualizer"></canvas>
    <canvas id="effect-canvas"></canvas>
    <audio id="bgm" src="wasted.mp3" loop></audio>

    <div class="top-bar">
        <div style="font-weight: bold; font-size: 1.1rem;">Li Zhenliang's Space</div>
        <div class="user-panel" id="user-status">
            <button class="login-btn" onclick="showLogin()">ç™»å½• / æ³¨å†Œ</button>
        </div>
    </div>

    <div class="modal" id="authModal" onclick="if(event.target===this) this.style.display='none'">
        <div class="modal-box">
            <h3 style="margin-bottom: 20px;">é€‰æ‹©ç™»å½•æ–¹å¼</h3>
            <button class="auth-btn btn-qq" onclick="socialLogin('QQ')"><i class="fab fa-qq"></i> QQ å¿«æ·ç™»å½•</button>
            <button class="auth-btn btn-wx" onclick="socialLogin('WeChat')"><i class="fab fa-weixin"></i> å¾®ä¿¡ä¸€é”®ç™»å½•</button>
            <div style="margin: 15px 0; color: #aaa; font-size: 12px;">- æˆ–è€… -</div>
            <button class="auth-btn btn-guest" onclick="guestLogin()">ğŸ‘» æ¸¸å®¢èº«ä»½è®¿é—®</button>
        </div>
    </div>

    <div class="modal" id="payModal" onclick="if(event.target===this) this.style.display='none'">
        <div class="modal-box" style="background: #fff; color: #333;">
            <h3>è¯·æˆ‘å–æ¯å’–å•¡</h3>
            <img src="pay.jpg" style="width: 100%; margin: 10px 0; border-radius: 8px;" alt="ä»˜æ¬¾ç ">
            <p>æ„Ÿè°¢è€æ¿å¤§æ°”ï¼</p>
        </div>
    </div>

    <div id="app">
        <div class="card profile-card">
            <img src="avatar.jpg" class="main-avatar" alt="Avatar">
            <h2>ææŒ¯äº®</h2>
            <p style="color: #aaa; margin: 5px 0;">æ±Ÿè¥¿è­¦å¯Ÿå­¦é™¢ | æ¢¦æƒ³ä¹Ÿæ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†</p>
            <a href="https://j.map.baidu.com/5f/2b" target="_blank" class="map-link">
                <i class="fas fa-location-dot"></i> æŸ¥çœ‹å­¦æ ¡ä½ç½®</a>
            
            <div class="social-bar">
                <div class="social-icon" onclick="copyToClip('3525613509', 'QQ')"><i class="fab fa-qq"></i></div>
                <div class="social-icon" onclick="copyToClip('L15374324282', 'å¾®ä¿¡')"><i class="fab fa-weixin"></i></div>
                <div class="social-icon" onclick="window.open('https://space.bilibili.com/470831665')"><i class="fab fa-bilibili"></i></div>
                <div class="social-icon" onclick="document.getElementById('payModal').style.display='flex'" style="background: #ff7675;"><i class="fas fa-yen-sign"></i></div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="tab active" onclick="switchTab('blog')">åŠ¨æ€åšå®¢</div>
            <div class="tab" onclick="switchTab('resource')">ä¸ªäººèµ„æºåº“</div>
        </div>

        <div class="search-box">
            <input type="text" class="search-input" id="search-input" placeholder="æœç´¢æ–‡ç« ã€èµ„æº...">
            <i class="fas fa-search search-icon" onclick="performSearch()"></i>
        </div>

        <div id="blog-tab" class="tab-content active">
            <div id="post-container">
                <div class="card" style="text-align:center; color:#aaa;">
                    <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨è¿æ¥æœåŠ¡å™¨...
                </div>
            </div>
        </div>

        <div id="resource-tab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 15px; border-left: 4px solid var(--accent); padding-left: 10px;">å¸¸ç”¨å·¥å…·</h3>
                <div class="grid-box" id="res-tools"></div>
            </div>
            <div class="card">
                <h3 style="margin-bottom: 15px; border-left: 4px solid var(--primary); padding-left: 10px;">å­¦ä¹ èµ„æ–™</h3>
                <div class="grid-box" id="res-study"></div>
            </div>
        </div>
    </div>

    <a href="/wp-admin" target="_blank" class="admin-link"><i class="fas fa-cog"></i> ç®¡ç†åå°</a>

<script>
    // --- é…ç½®ä¸­å¿ƒ (è¿æ¥ä½ çš„é˜¿é‡Œäº‘æœåŠ¡å™¨) ---
    const CONFIG = {
        // ä½ çš„å…¬å…±åŸŸåï¼Œä¾‹å¦‚ 'http://123.456.78.90' æˆ– 'https://yourname.com'
        // æ³¨æ„ï¼šå¦‚æœä½ åœ¨æœ¬åœ°è¿è¡Œæ­¤HTMLï¼Œéœ€è¦ä½ çš„WordPresså¼€å¯è·¨åŸŸ(CORS)
        apiBase: '', // ç•™ç©ºåˆ™ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®ï¼Œå¡«å…¥ 'https://ä½ çš„åŸŸå/wp-json/wp/v2' å¯ç”¨çœŸå®åç«¯
        defaultAvatar: 'avatar.jpg'
    };

    // --- 1. æ¨¡æ‹Ÿæ•°æ®åº“ (å½“æ²¡æœ‰è¿æ¥çœŸå®åç«¯æ—¶ä½¿ç”¨) ---
    const mockPosts = [
        { id: 1, title: 'ç½‘ç«™æ­å»ºå®Œæˆï¼', content: 'åŸºäºã€Šä½ çš„åå­—ã€‹é£æ ¼ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®æˆ‘çš„ä¸ªäººç©ºé—´ã€‚', date: '2025-12-05', likes: 12, comments: [] },
        { id: 2, title: 'Termux ç»ˆç«¯ä½¿ç”¨æŠ€å·§', content: 'åœ¨å®‰å“æ‰‹æœºä¸Šè¿è¡Œ Linux ç¯å¢ƒçš„ç¥å™¨...', date: '2025-12-06', likes: 5, comments: [] }
    ];
    
    // --- 2. èµ„æºæ•°æ® (ä»ä½ æä¾›çš„æ–‡ä»¶æå–) ---
    const resources = [
        { cat: 'tools', title: 'Termux', url: 'https://github.com/termux/termux-app', icon: 'fa-terminal' },
        { cat: 'tools', title: 'Rufus', url: 'https://rufus.ie/downloads/', icon: 'fa-compact-disc' },
        { cat: 'tools', title: 'ç§˜å¡”å†™ä½œçŒ«', url: 'https://xiezuocat.com/', icon: 'fa-pen-fancy' },
        { cat: 'study', title: 'Cè¯­è¨€æ•™ç¨‹', url: 'https://www.bilibili.com/video/BV1Ps411U7tS', icon: 'fa-code' },
        { cat: 'study', title: 'Kali Linux', url: 'https://www.bilibili.com/video/BV1ho4y1D7vh', icon: 'fa-mask' },
        { cat: 'study', title: 'ThinkPHP', url: 'https://www.thinkphp.cn/', icon: 'fa-php' }
    ];

    // --- 3. ç”¨æˆ·ç³»ç»Ÿ ---
    let currentUser = null;

    function initUser() {
        // å°è¯•ä»æœ¬åœ°å­˜å‚¨è·å–ç™»å½•çŠ¶æ€
        const stored = localStorage.getItem('user_info');
        if (stored) {
            currentUser = JSON.parse(stored);
            updateUserUI();
        }
    }

    function showLogin() { document.getElementById('authModal').style.display = 'flex'; }

    function guestLogin() {
        currentUser = { name: 'æ¸¸å®¢_' + Math.floor(Math.random()*1000), role: 'guest', avatar: 'https://api.dicebear.com/7.x/adventurer/svg?seed=Guest' };
        loginSuccess();
    }

    function socialLogin(platform) {
        // çœŸå®ç¯å¢ƒä¸­ï¼Œè¿™é‡Œéœ€è¦è°ƒç”¨å¾®ä¿¡/QQçš„ OAuth2 æ¥å£ï¼Œå›è°ƒåˆ°ä½ çš„ WordPress åç«¯
        // è¿™é‡Œæ¨¡æ‹Ÿç™»å½•æˆåŠŸ
        alert(`æ­£åœ¨å”¤èµ· ${platform} æˆæƒ... (æ¨¡æ‹ŸæˆåŠŸ)`);
        currentUser = { 
            name: platform + 'ç”¨æˆ·', 
            role: 'user', 
            avatar: platform === 'QQ' ? 'https://api.dicebear.com/7.x/adventurer/svg?seed=QQ' : 'https://api.dicebear.com/7.x/adventurer/svg?seed=WX' 
        };
        loginSuccess();
    }

    function loginSuccess() {
        localStorage.setItem('user_info', JSON.stringify(currentUser));
        updateUserUI();
        document.getElementById('authModal').style.display = 'none';
        document.getElementById('bgm').play().catch(()=>{}); // å°è¯•æ’­æ”¾éŸ³ä¹
    }

    function updateUserUI() {
        const panel = document.getElementById('user-status');
        panel.innerHTML = `
            <img src="${currentUser.avatar}" class="user-avatar">
            <span>${currentUser.name}</span>
            <i class="fas fa-sign-out-alt" style="margin-left:10px; cursor:pointer;" onclick="logout()"></i>
        `;
    }

    function logout() {
        localStorage.removeItem('user_info');
        currentUser = null;
        document.getElementById('user-status').innerHTML = `<button class="login-btn" onclick="showLogin()">ç™»å½• / æ³¨å†Œ</button>`;
    }

    // --- 4. åšå®¢é€»è¾‘ (è¿æ¥åç«¯æ ¸å¿ƒ) ---
    async function loadPosts(search = '') {
        const container = document.getElementById('post-container');
        container.innerHTML = '';

        let posts = [];

        if (CONFIG.apiBase) {
            // ---> çœŸå®åç«¯é€»è¾‘ <---
            try {
                let url = `${CONFIG.apiBase}/posts?_embed`;
                if(search) url += `&search=${search}`;
                const res = await fetch(url);
                const data = await res.json();
                posts = data.map(p => ({
                    id: p.id,
                    title: p.title.rendered,
                    content: p.excerpt.rendered,
                    date: p.date.split('T')[0],
                    likes: 0, // WPé»˜è®¤æ²¡æœ‰ç‚¹èµï¼Œéœ€æ’ä»¶æ”¯æŒï¼Œè¿™é‡Œæš‚æ—¶ç½®0
                    comments: []
                }));
            } catch (e) {
                container.innerHTML = `<div class="card">è¿æ¥åç«¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®ã€‚<br>${e.message}</div>`;
                return;
            }
        } else {
            // ---> æœ¬åœ°æ¨¡æ‹Ÿé€»è¾‘ <---
            posts = mockPosts.filter(p => p.title.includes(search) || p.content.includes(search));
        }

        posts.forEach(post => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <h3>${post.title}</h3>
                <div style="font-size:0.9rem; margin:10px 0; line-height:1.6;">${post.content}</div>
                <div class="post-meta">
                    <span>${post.date}</span>
                    <div class="post-actions">
                        <span onclick="likePost(this, ${post.id})"><i class="far fa-heart"></i> ${post.likes}</span>
                        <span onclick="toggleComments(${post.id})"><i class="far fa-comment"></i> è¯„è®º</span>
                    </div>
                </div>
                <div id="comment-box-${post.id}" class="comment-section">
                    <div class="comment-list" id="list-${post.id}"></div>
                    <input type="text" class="comment-input" placeholder="è¾“å…¥è¯„è®ºï¼Œå›è½¦å‘é€..." onkeypress="handleComment(event, ${post.id})">
                </div>
            `;
            container.appendChild(div);
        });
        
        if(posts.length === 0) container.innerHTML = '<div class="card" style="text-align:center">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</div>';
    }

    // --- 5. äº¤äº’åŠŸèƒ½ (ç‚¹èµ/è¯„è®º) ---
    function likePost(el, pid) {
        if (!currentUser) return showLogin();
        // åŠ¨æ•ˆ
        const icon = el.querySelector('i');
        if (icon.classList.contains('far')) {
            icon.classList.replace('far', 'fas');
            el.classList.add('liked');
            el.innerHTML = `<i class="fas fa-heart"></i> ${parseInt(el.innerText) + 1}`;
            // è¿™é‡Œåº”å‘é€ API è¯·æ±‚åˆ°åç«¯ä¿å­˜ç‚¹èµ
        } else {
            icon.classList.replace('fas', 'far');
            el.classList.remove('liked');
            el.innerHTML = `<i class="far fa-heart"></i> ${parseInt(el.innerText) - 1}`;
        }
    }

    function toggleComments(id) {
        const box = document.getElementById(`comment-box-${id}`);
        box.classList.toggle('active');
    }

    function handleComment(e, pid) {
        if (e.key === 'Enter') {
            if (!currentUser) return showLogin();
            const text = e.target.value;
            if (!text) return;

            const list = document.getElementById(`list-${pid}`);
            const item = document.createElement('div');
            item.className = 'comment-item';
            item.innerHTML = `<span style="color:var(--accent)">${currentUser.name}:</span> ${text}`;
            list.appendChild(item);
            e.target.value = '';
            // è¿™é‡Œåº”å‘é€ API POST è¯·æ±‚åˆ° WordPress æäº¤è¯„è®º
        }
    }

    function performSearch() {
        const val = document.getElementById('search-input').value;
        switchTab('blog');
        loadPosts(val);
    }

    // --- 6. è¾…åŠ©åŠŸèƒ½ ---
    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        event.currentTarget.classList.add('active'); // Bug fix: Ensure this triggers on click
        // æ‰‹åŠ¨å¤„ç†activeçŠ¶æ€ï¼Œå¦‚æœ event.currentTarget ä¸å­˜åœ¨
        const tabs = document.querySelectorAll('.tab');
        if(tab === 'blog') tabs[0].classList.add('active');
        else tabs[1].classList.add('active');

        document.getElementById(tab + '-tab').classList.add('active');
    }

    function copyToClip(text, type) {
        navigator.clipboard.writeText(text).then(() => {
            alert(`${type}è´¦å· ${text} å·²å¤åˆ¶ï¼`);
            if (type === 'QQ') window.location.href = `mqqwpa://im/chat?chat_type=wpa&uin=${text}&version=1&src_type=web`;
            if (type === 'å¾®ä¿¡') window.location.href = `mqqwpa://im/chat?chat_type=wpa&uin=${text}&version=1&src_type=web`;
            if (type === 'å¾®ä¿¡') window.location.href = "weixin://";
        });
    }

    // --- 7. åˆå§‹åŒ–èµ„æº ---
    function initResources() {
        resources.forEach(res => {
            const html = `<a href="${res.url}" target="_blank" class="res-btn"><i class="fas ${res.icon}"></i>${res.title}</a>`;
            const container = document.getElementById(`res-${res.cat}`) || document.getElementById('res-tools');
            container.innerHTML += html;
        });
    }

    // --- 8. ç‰¹æ•ˆä¸åŠ¨ç”» (è§¦æ§ä¼˜å…ˆå±‚çº§ä¿®æ­£) ---
    const eCanvas = document.getElementById('effect-canvas');
    const eCtx = eCanvas.getContext('2d');
    let sparks = [];

    function resizeCanvas() {
        eCanvas.width = window.innerWidth;
        eCanvas.height = window.innerHeight;
        document.getElementById('star-canvas').width = window.innerWidth;
        document.getElementById('star-canvas').height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);

    class Spark {
        constructor(x, y) {
            this.x = x; this.y = y;
            this.vx = (Math.random() - 0.5) * 8;
            this.vy = (Math.random() - 0.5) * 8;
            this.life = 1;
            this.color = `hsl(${Math.random()*360}, 100%, 70%)`;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            this.vy += 0.1; // Gravity
            this.life -= 0.03;
        }
        draw() {
            eCtx.globalAlpha = this.life;
            eCtx.fillStyle = this.color;
            eCtx.beginPath();
            eCtx.arc(this.x, this.y, 2, 0, Math.PI*2);
            eCtx.fill();
        }
    }

    function loopEffects() {
        eCtx.clearRect(0, 0, eCanvas.width, eCanvas.height);
        for(let i=0; i<sparks.length; i++) {
            sparks[i].update();
            sparks[i].draw();
            if(sparks[i].life <= 0) { sparks.splice(i, 1); i--; }
        }
        requestAnimationFrame(loopEffects);
    }

    // ç›‘å¬è§¦æ§/ç‚¹å‡» (ç»‘å®šåœ¨windowä¸Šï¼Œä½†canvas pointer-events:none ä¿è¯ç‚¹å‡»ç©¿é€)
    ['mousedown', 'touchstart'].forEach(evt => {
        window.addEventListener(evt, (e) => {
            const x = e.clientX || e.touches[0].clientX;
            const y = e.clientY || e.touches[0].clientY;
            for(let i=0; i<8; i++) sparks.push(new Spark(x, y));
        }, {passive: true});
    });

    // --- 9. èƒŒæ™¯æ˜Ÿç©º (ç®€åŒ–ç‰ˆ) ---
    const sCanvas = document.getElementById('star-canvas');
    const sCtx = sCanvas.getContext('2d');
    const stars = Array.from({length: 100}, () => ({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: Math.random() * 2,
        a: Math.random()
    }));

    function drawStars() {
        sCtx.clearRect(0,0,sCanvas.width,sCanvas.height);
        sCtx.fillStyle = "white";
        stars.forEach(s => {
            s.a += (Math.random() - 0.5) * 0.05;
            sCtx.globalAlpha = Math.max(0, Math.min(1, s.a));
            sCtx.beginPath();
            sCtx.arc(s.x, s.y, s.r, 0, Math.PI*2);
            sCtx.fill();
        });
        requestAnimationFrame(drawStars);
    }

    // --- å¯åŠ¨ ---
    window.onload = () => {
        resizeCanvas();
        initUser();
        initResources();
        loadPosts();
        loopEffects();
        drawStars();
        
        // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹
        document.body.addEventListener('click', () => {
            const bgm = document.getElementById('bgm');
            if(bgm.paused) bgm.play();
        }, {once:true});
    };

</script>
</body>
</html>
